<html>
  <!-- 장바구니, 바코드는 추후 예정-->
<a href="{% url 'food:recipe_input' %}">⟨</a> {{ total_point }}P

  <h3>{{ recipe }} 재료 담기</h3>
  <p>인근 마트에 재고가 있는 재료만 보여요!</p>
  <p>이 중 구매할 재료를 장바구니에 담아주세요</p>

  <hr>

  <form method="post">
    {% csrf_token %}
    <!-- (선택) 뷰가 세션도 보지만, 안정적으로 현재 레시피명을 넘겨두자 -->
    <input type="hidden" name="recipe" value="{{ recipe }}">

    <!-- 기본 재료 -->
    <h3>기본 재료</h3>
    {% if basic and basic|length > 0 %}
      {% for i in basic %}
        <label>
          <input type="checkbox" name="ingredients" value="{{ i }}" checked>
          {{ i }}
        </label><br>
      {% endfor %}
    {% else %}
      <p>등록된 기본 재료가 없습니다.</p>
    {% endif %}

    <!-- 선택 재료 -->
    <h3>선택 재료</h3>
    {% if optional and optional|length > 0 %}
      {% for i in optional %}
        <label>
          <input
            type="checkbox"
            name="ingredients"
            value="{{ i }}"
            {% if optional_selected and i in optional_selected %}checked{% endif %}
          >
          {{ i }}
        </label><br>
      {% endfor %}
    {% else %}
      <p>등록된 선택 재료가 없습니다.</p>
    {% endif %}

    <!-- 직접 추가한 재료 (GPT 목록에 없는 장바구니 항목) -->
    {% if extra_ingredients and extra_ingredients|length > 0 %}
      <br><h3>직접 추가한 재료</h3>
      {% for i in extra_ingredients %}
        <label>
          <input type="checkbox" name="ingredients" value="{{ i }}" checked>
          {{ i }}
        </label><br>
      {% endfor %}
    {% endif %}

    <br>
    <!-- 두 버튼 모두 같은 form 내에서 동작 (뷰에서 next 값으로 분기) -->
    <button type="submit" name="next" value="search">재료 직접 담기</button> <button type="submit" name="next" value="confirm">다음</button>
  </form>

<!-- 메시지 영역 -->
{% if messages %}
  <ul>
    {% for message in messages %}
      {{ message }}
    {% endfor %}
  </ul>
{% endif %}

</body>
</html>