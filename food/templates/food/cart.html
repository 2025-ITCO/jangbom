<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>장바구니</title>
</head>
<body>
  <a href="javascript:history.back()">✕</a>

  <h2>장바구니</h2>
  <p>잘 보러 갈 준비 되었나요?</p>

  {% if not shopping_list or not items %}
    <p>장바구니에 담긴 식재료가 없어요</p>
  {% else %}
    <form method="post" action="{% url 'food:cart_view' %}">
      {% csrf_token %}

      <label><input type="checkbox" id="check-all"> 전체 선택</label>
      <button type="submit" name="action" value="remove_selected">선택 삭제</button>

      <hr>

      <ul>
        {% for it in items %}
          <li>
            <input type="checkbox" name="selected" value="{{ it.id }}">
            {% if it.ingredient.image %}
              <img src="{{ it.ingredient.image.url }}" alt="{{ it.ingredient.name }}">
            {% endif %}
            <span>{{ it.ingredient.name }} {{ shopping_list.created_at|date:"Y.m.d" }}</span>
            <button type="submit" name="remove_one" value="{{ it.id }}" aria-label="삭제">×</button>
          </li>
        {% endfor %}
      </ul>

      <button type="submit" name="action" value="go_confirm">장 보러 가기</button>
    </form>
  {% endif %}

  <script>
    (function () {
      var allBox = document.getElementById('check-all');
      if (!allBox) return;
      allBox.addEventListener('change', function () {
        var boxes = document.querySelectorAll('input[name="selected"]');
        boxes.forEach(function (cb) { cb.checked = allBox.checked; });
      });
    })();
  </script>
</body>
</html>
